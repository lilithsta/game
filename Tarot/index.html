<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ä»Šæ—¥å¡”ç½—å åœ Tarot of the Day</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:radial-gradient(circle at center,#1a1b2f,#0d1321);color:#fff;font-family:"Noto Sans SC","Noto Sans JP",sans-serif;text-align:center;margin:0;padding:0;overflow-x:hidden;transition:background 1s ease;}
h1{margin-top:30px;font-size:1.8em;text-shadow:0 0 10px #a29bfe;}
button,select{margin:8px;background:#6c5ce7;border:none;color:#fff;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:15px;}
button:hover{background:#a29bfe;}
.container{display:flex;justify-content:center;align-items:flex-start;flex-wrap:wrap;margin-top:20px;gap:25px;}
.card-area{flex:0 0 260px;display:flex;justify-content:center;position:relative;}
.card{width:240px;height:420px;border-radius:10px;box-shadow:0 0 20px #6c5ce7;background-color:#2d3436;perspective:1000px;position:relative;}
.inner{width:100%;height:100%;transition:transform 1s cubic-bezier(0.4,0.2,0.2,1);transform-style:preserve-3d;position:relative;}
.flip .inner{transform:rotateY(180deg) rotateZ(360deg);}
.front,.back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:10px;}
.front{background-size:cover;background-position:center;}
.back{transform:rotateY(180deg);background:rgba(30,30,60,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:15px;}
#cardName{font-size:1.2em;margin-bottom:10px;color:#ffd86b;}
#meaning{font-size:0.95em;line-height:1.4em;}
.fortune-area{flex:0 0 340px;background:rgba(255,255,255,0.08);border-radius:12px;padding:15px;text-align:left;box-shadow:0 0 10px rgba(0,0,0,0.3);min-height:420px;}
.fortune-area h3{text-align:center;color:#ffd86b;margin-top:0;}
.fortune-item{margin:6px 0;}
.stars{color:#ffd700;font-size:1.1em;}
@media(max-width:768px){.container{flex-direction:column;align-items:center;}.fortune-area{width:90%;min-height:auto;}}
footer{color:#aaa;font-size:0.8em;margin:30px 0;}
/* âœ¨ ç²’å­ç‰¹æ•ˆ */
.particle{
  position:absolute;
  width:6px;height:6px;
  background:radial-gradient(circle,#fff,#6c5ce7);
  border-radius:50%;
  animation:floatUp 1.2s ease-out forwards;
  pointer-events:none;
  opacity:0.8;
}
@keyframes floatUp{
  0%{transform:translateY(0) scale(1);opacity:1;}
  100%{transform:translateY(-120px) scale(0.2);opacity:0;}
}
</style>
</head>
<body>

<h1>ğŸ”® ä»Šæ—¥å¡”ç½—å åœ Tarot of the Day / ä»Šæ—¥ã®ã‚¿ãƒ­ãƒƒãƒˆå ã„</h1>
<div>
  <select id="langSelect">
    <option value="zh">ä¸­æ–‡</option>
    <option value="en">English</option>
    <option value="jp">æ—¥æœ¬èª</option>
  </select>
  <button id="drawBtn">å¼€å§‹æŠ½ç‰Œ / Draw / ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã</button>
  <button id="resetBtn" style="display:none;background:#e17055;">ğŸŒ€ é‡æ–°æŠ½ç‰Œ / Redraw / å†å ã†</button>
</div>

<div class="container">
  <div class="card-area">
    <div class="card" id="tarotCard">
      <div class="inner">
        <div class="front" id="front"></div>
        <div class="back">
          <h2 id="cardName"></h2>
          <p id="meaning"></p>
        </div>
      </div>
    </div>
  </div>

  <div class="fortune-area" id="fortuneBox" style="display:none;">
    <h3 id="fortuneTitle">ğŸŒŸ ä»Šæ—¥è¿åŠ¿æŠ¥å‘Š</h3>
    <div id="fortuneText"></div>
  </div>
</div>

<footer>Â© 2025 ä»Šæ—¥å¡”ç½— Â· Tarot of the Day</footer>

<script>
document.addEventListener("DOMContentLoaded", async ()=>{
const elementsColor={m:"#5e4fa2",c:"#2e86de",w:"#ff8c42",s:"#b2bec3",p:"#55efc4"};
const btn=document.getElementById("drawBtn"),reset=document.getElementById("resetBtn");
const card=document.getElementById("tarotCard"),inner=card.querySelector(".inner"),front=document.getElementById("front");
const cardName=document.getElementById("cardName"),meaning=document.getElementById("meaning");
const langSelect=document.getElementById("langSelect");
const fortuneBox=document.getElementById("fortuneBox"),fortuneTitle=document.getElementById("fortuneTitle"),fortuneText=document.getElementById("fortuneText");
const cardArea=document.querySelector(".card-area");

let tarotDeck=[];
await fetch("tarotDeck.json").then(r=>r.json()).then(d=>tarotDeck=d)
.catch(()=>alert("âŒ æ— æ³•åŠ è½½ tarotDeck.json"));

// å›¾ç‰‡è·¯å¾„
function getImgUrl(id,suit){
  if(!suit){console.warn("âš ï¸ suit undefined:",id);return "images/default.jpg";}
  return `images/${String(suit).toLowerCase()}${String(id).padStart(2,"0")}.jpg`;
}

// å¤šè¯­è¨€å­—å…¸
const i18n={
  zh:{title:"ğŸŒŸ ä»Šæ—¥è¿åŠ¿æŠ¥å‘Š",categories:["ğŸ’˜ çˆ±æƒ…","ğŸ’¼ äº‹ä¸š","ğŸ’ª å¥åº·"],
      reversed:"é€†ä½ï¼šæš—ç¤ºå†…åœ¨çŸ›ç›¾æˆ–é˜»ç¢ï¼Œè¯·ä¿æŒå†·é™ã€‚",
      upright:"æ­£ä½ï¼šèƒ½é‡æµåŠ¨é¡ºç•…ï¼Œä»£è¡¨ç§¯æå‰è¿›ã€‚",
      love:["æ„Ÿæƒ…ä¸Šéœ€çœŸè¯šæ²Ÿé€š","çˆ±æƒ…æœ‰æ–°æœºé‡","æ³¨æ„è¯¯ä¼šä¸å†·æ·¡","æµªæ¼«èƒ½é‡å¢å¼º"],
      career:["å·¥ä½œè¿›å±•é¡ºåˆ©","é€‚åˆå›¢é˜Ÿåˆä½œ","æ³¨æ„è®¡åˆ’ä¸è€å¿ƒ","æœ‰æ™‹å‡æœºä¼š"],
      health:["ä¿æŒè§„å¾‹ä½œæ¯","æ³¨æ„æƒ…ç»ªå‹åŠ›","ç²¾åŠ›å……æ²›","é¥®é£Ÿéœ€å‡è¡¡"],
      draw:"å¼€å§‹æŠ½ç‰Œ",redraw:"ğŸŒ€ é‡æ–°æŠ½ç‰Œ",drawn:"ä»Šæ—¥å·²æŠ½ç‰Œï¼ˆç‚¹å‡»é‡æ–°æŸ¥çœ‹ï¼‰"},
  en:{title:"ğŸŒŸ Daily Fortune Report",categories:["ğŸ’˜ Love","ğŸ’¼ Career","ğŸ’ª Health"],
      reversed:"Reversed: Indicates inner conflicts or obstacles â€” stay calm.",
      upright:"Upright: Energy flows positively â€” progress is likely.",
      love:["Be honest in love.","New romantic chance.","Avoid misunderstandings.","Emotional energy flows strongly."],
      career:["Work goes smoothly.","Good for teamwork.","Stay patient and plan.","Opportunity for promotion."],
      health:["Keep a regular routine.","Manage stress.","Energetic and active.","Eat balanced meals."],
      draw:"Draw Card",redraw:"ğŸŒ€ Redraw",drawn:"Already drawn (click to review)"},
  jp:{title:"ğŸŒŸ ä»Šæ—¥ã®é‹å‹¢ãƒ¬ãƒãƒ¼ãƒˆ",categories:["ğŸ’˜ æ‹æ„›","ğŸ’¼ ä»•äº‹","ğŸ’ª å¥åº·"],
      reversed:"é€†ä½ç½®ï¼šå†…é¢ã®æ··ä¹±ã‚„åœæ»ã‚’ç¤ºã—ã¾ã™ã€‚å†·é™ã•ã‚’ä¿ã£ã¦ã€‚",
      upright:"æ­£ä½ç½®ï¼šå‰å‘ããªæµã‚Œã¨ç™ºå±•ã®å…†ã—ãŒã‚ã‚Šã¾ã™ã€‚",
      love:["æ‹æ„›ã§ã¯èª å®Ÿãªä¼šè©±ã‚’ã€‚","æ–°ã—ã„å‡ºä¼šã„ã®å…†ã—ã€‚","èª¤è§£ã‚„å†·æ·¡ã«æ³¨æ„ã€‚","ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªæ°—é…ã€‚"],
      career:["ä»•äº‹ã¯é †èª¿ã€‚","ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå‰ã€‚","è¨ˆç”»ã¨å¿è€ãŒå¤§åˆ‡ã€‚","æ˜‡é€²ã®ãƒãƒ£ãƒ³ã‚¹ã‚ã‚Šã€‚"],
      health:["ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’æ•´ãˆã¦ã€‚","ã‚¹ãƒˆãƒ¬ã‚¹ã«æ³¨æ„ã€‚","æ´»åŠ›ã«ã‚ãµã‚Œã‚‹æ—¥ã€‚","é£Ÿäº‹ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚ã†ã€‚"],
      draw:"ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã",redraw:"ğŸŒ€ å†å ã†",drawn:"æœ¬æ—¥åˆ†ã¯å¼•ãæ¸ˆã¿ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å†è¡¨ç¤ºï¼‰"}
};

// ğŸŒ  ç²’å­ç‰¹æ•ˆç”Ÿæˆ
function spawnParticles(color="#a29bfe"){
  for(let i=0;i<18;i++){
    const p=document.createElement("div");
    p.classList.add("particle");
    const x=(Math.random()-0.5)*200;
    const y=Math.random()*60-20;
    const size=Math.random()*6+3;
    p.style.left="50%";p.style.top="50%";
    p.style.width=size+"px";p.style.height=size+"px";
    p.style.background=`radial-gradient(circle,${color},transparent 80%)`;
    p.style.transform=`translate(${x}px,${y}px)`;
    cardArea.appendChild(p);
    setTimeout(()=>p.remove(),1200);
  }
}

// éšæœºç”Ÿæˆè¿åŠ¿æ•°æ®
function genFortuneData(){
  return {
    love: Math.floor(Math.random()*4),
    career: Math.floor(Math.random()*4),
    health: Math.floor(Math.random()*4),
    stars: [Math.floor(Math.random()*3+3), Math.floor(Math.random()*3+3), Math.floor(Math.random()*3+3)]
  };
}

// æ¸²æŸ“æŠ¥å‘Šï¼ˆå¸¦ä¿®å¤é€»è¾‘ï¼‰
function renderFortune(card,reversed,lang,data){
  if(!data || data.love == null){
    console.warn("âš ï¸ fortuneData invalid, regenerating...", data);
    data = genFortuneData();
  }
  const t=i18n[lang]||i18n.zh;
  fortuneTitle.textContent=t.title;
  const parts=[
    `${t.categories[0]}ï¼š${t.love[data.love]} <span class='stars'>${"â˜…".repeat(data.stars[0])}</span>`,
    `${t.categories[1]}ï¼š${t.career[data.career]} <span class='stars'>${"â˜…".repeat(data.stars[1])}</span>`,
    `${t.categories[2]}ï¼š${t.health[data.health]} <span class='stars'>${"â˜…".repeat(data.stars[2])}</span>`
  ].map(s=>`<div class='fortune-item'>${s}</div>`).join("");
  fortuneText.innerHTML=parts+`<hr style='opacity:0.3'>
   ğŸ“– <b>${card.name[lang]||card.name.zh}</b>ï¼š${card.meaning[lang]||card.meaning.zh}<br>
   ğŸ”„ ${reversed?t.reversed:t.upright}`;
  fortuneBox.style.display="block";
}

// æœ¬åœ°ç¼“å­˜
const todayKey=new Date().toISOString().slice(0,10);
let saved=JSON.parse(localStorage.getItem("tarot_today")||"null");
if(saved&&saved.date===todayKey){
  showCard(saved.card,saved.reversed,saved.lang,saved.fortuneData,true);
  btn.textContent=i18n[saved.lang].drawn;
  reset.style.display="inline-block";
}

// æŠ½ç‰Œ
btn.addEventListener("click",()=>{
  const lang=langSelect.value;
  const stored=JSON.parse(localStorage.getItem("tarot_today")||"null");
  if(stored&&stored.date===todayKey){
    showCard(stored.card,stored.reversed,lang,stored.fortuneData,true);
    return;
  }
  const card=tarotDeck[Math.floor(Math.random()*tarotDeck.length)];
  const reversed=Math.random()<0.5;
  const fortuneData=genFortuneData();
  localStorage.setItem("tarot_today",JSON.stringify({date:todayKey,card,reversed,lang,fortuneData}));
  showCard(card,reversed,lang,fortuneData,false);
  btn.textContent=i18n[lang].drawn;
  reset.style.display="inline-block";
  spawnParticles(elementsColor[card.suit]);
});

// é‡æ–°æŠ½ç‰Œ
reset.addEventListener("click",()=>{
  const lang=langSelect.value;
  localStorage.removeItem("tarot_today");
  fortuneBox.style.display="none";
  btn.textContent=i18n[lang].draw;
  reset.style.display="none";
  inner.classList.remove("flip");
  front.style.backgroundImage="";
  cardName.textContent="";
  meaning.textContent="";
  spawnParticles("#55efc4");
});

// æ˜¾ç¤ºå¡ç‰‡
function showCard(card,reversed,lang,fortuneData,isCached){
  if(!fortuneData || fortuneData.love==null){fortuneData=genFortuneData();}
  const img=getImgUrl(card.id,card.suit);
  front.style.backgroundImage=`url('${img}')`;
  front.style.transform=reversed?"rotate(180deg)":"rotate(0)";
  cardName.textContent=card.name[lang]+(reversed?"ï¼ˆé€†ä½ï¼‰":"ï¼ˆæ­£ä½ï¼‰");
  meaning.textContent=(reversed?"ã€é€†ä½å«ä¹‰ã€‘":"ã€æ­£ä½å«ä¹‰ã€‘")+" "+card.meaning[lang];
  document.body.style.background=`radial-gradient(circle at center, ${elementsColor[card.suit]||"#6c5ce7"}, #0d1321)`;
  inner.classList.add("flip");
  renderFortune(card,reversed,lang,fortuneData);
}

// åˆ‡æ¢è¯­è¨€
langSelect.addEventListener("change",()=>{
  const lang=langSelect.value;
  const stored=JSON.parse(localStorage.getItem("tarot_today")||"null");
  btn.textContent=i18n[lang].draw;
  reset.textContent=i18n[lang].redraw;
  if(stored&&stored.date===todayKey){
    btn.textContent=i18n[lang].drawn;
    showCard(stored.card,stored.reversed,lang,stored.fortuneData,true);
    reset.style.display="inline-block";
  }
});
});
</script>
</body>
</html>
