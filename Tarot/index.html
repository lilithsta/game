<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>今日塔罗占卜 Tarot of the Day</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:radial-gradient(circle at center,#1a1b2f,#0d1321);color:#fff;
font-family:"Noto Sans SC","Noto Sans JP",sans-serif;text-align:center;margin:0;padding:0;transition:background 1s ease;}
h1{margin-top:40px;font-size:1.8em;text-shadow:0 0 10px #a29bfe;}
#langSelect{margin:10px;background:#00cec9;border:none;color:#fff;padding:8px 12px;border-radius:6px;cursor:pointer;}
#drawBtn{background:#6c5ce7;border:none;color:#fff;padding:12px 24px;border-radius:10px;cursor:pointer;font-size:16px;transition:all 0.3s;margin-top:20px;}
#drawBtn:hover{background:#a29bfe;}
.card{width:240px;height:420px;margin:40px auto;border-radius:10px;box-shadow:0 0 20px #6c5ce7;background-color:#2d3436;perspective:1000px;position:relative;}
.inner{width:100%;height:100%;transition:transform 0.8s;transform-style:preserve-3d;position:relative;}
.flip .inner{transform:rotateY(180deg);}
.front,.back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:10px;}
.front{background-size:cover;background-position:center;}
.back{transform:rotateY(180deg);background:rgba(30,30,60,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:15px;}
#cardName{font-size:1.2em;margin-bottom:10px;color:#ffd86b;}
#meaning{font-size:0.95em;line-height:1.4em;}
#fortuneBox{margin:20px auto;width:85%;max-width:500px;background:rgba(255,255,255,0.08);border-radius:12px;padding:15px;text-align:left;box-shadow:0 0 10px rgba(0,0,0,0.3);}
#fortuneBox h3{text-align:center;color:#ffd86b;}
.fortune-item{margin:6px 0;}
.stars{color:#ffd700;font-size:1.1em;}
footer{color:#aaa;font-size:0.8em;margin-bottom:20px;}
</style>
</head>
<body>

<h1>🔮 今日塔罗占卜 Tarot of the Day</h1>
<select id="langSelect">
  <option value="zh">中文</option>
  <option value="en">English</option>
  <option value="jp">日本語</option>
</select><br>
<button id="drawBtn">开始抽牌 / Draw / カードを引く</button>

<div class="card" id="tarotCard">
  <div class="inner">
    <div class="front" id="front"></div>
    <div class="back">
      <h2 id="cardName"></h2>
      <p id="meaning"></p>
    </div>
  </div>
</div>

<div id="fortuneBox" style="display:none;">
  <h3>🌟 今日运势报告</h3>
  <div id="fortuneText"></div>
</div>

<footer>© 2025 今日塔罗 · Tarot of the Day</footer>

<script>
document.addEventListener("DOMContentLoaded", async ()=>{
const elementsColor={m:"#5e4fa2",c:"#2e86de",w:"#ff8c42",s:"#b2bec3",p:"#55efc4"};
const btn=document.getElementById("drawBtn"),card=document.getElementById("tarotCard"),
inner=card.querySelector(".inner"),front=document.getElementById("front"),
cardName=document.getElementById("cardName"),meaning=document.getElementById("meaning"),
langSelect=document.getElementById("langSelect"),fortuneBox=document.getElementById("fortuneBox"),
fortuneText=document.getElementById("fortuneText");

// 载入JSON
let tarotDeck = [];
await fetch("tarotDeck.json")
  .then(res=>res.json())
  .then(data=>{
    tarotDeck = data;
    // 添加小阿尔卡那
    ["c","w","s","p"].forEach(suit=>{
      for(let i=1;i<=14;i++){
        tarotDeck.push({
          id:i,suit,
          name:{zh:`${{"c":"圣杯","w":"权杖","s":"宝剑","p":"钱币"}[suit]}${i}`,
                en:`${{"c":"Cups","w":"Wands","s":"Swords","p":"Pentacles"}[suit]} ${i}`,
                jp:`${{"c":"カップ","w":"ワンド","s":"ソード","p":"ペンタクル"}[suit]}の${i}`},
          meaning:{zh:{"c":"情感与关系","w":"行动与创造","s":"思想与真理","p":"物质与事业"}[suit],
                   en:{"c":"Emotion & relationship","w":"Action & creativity","s":"Mind & truth","p":"Material & work"}[suit],
                   jp:{"c":"感情と関係","w":"行動と創造","s":"思考と真実","p":"物質と仕事"}[suit]}
        });
      }
    });
  })
  .catch(err=>alert("❌ 无法加载 tarotDeck.json，请确认文件存在。"));

// 图片路径
function getImgUrl(id,suit){const s=suit?suit.toLowerCase():"m";return `images/${s}${String(id).padStart(2,"0")}.jpg`;}

// 生成今日运势
function randomStars(){return "★".repeat(Math.floor(Math.random()*3+3));}
function genFortune(card,reversed,lang){
  const base={
    zh:{love:["感情上需真诚沟通","爱情有新机遇","注意误会与冷淡","浪漫能量增强"],
        career:["工作进展顺利","适合团队合作","注意计划与耐心","有晋升机会"],
        health:["保持规律作息","注意情绪压力","精力充沛","饮食需均衡"],
        revHint:"逆位：暗示内在矛盾或阻碍，请保持冷静。",
        norHint:"正位：能量流动顺畅，代表积极前进。"},
    en:{love:["Be honest in love.","New romantic chance.","Avoid misunderstandings.","Emotional energy flows strongly."],
        career:["Work goes well.","Good for teamwork.","Stay patient.","Chance for promotion."],
        health:["Keep a good routine.","Manage stress.","Energetic today.","Eat balanced meals."],
        revHint:"Reversed: Blockage or confusion—stay calm.",
        norHint:"Upright: Energy flows positively."}
  }[lang]||base.zh;
  const pick=a=>a[Math.floor(Math.random()*a.length)];
  fortuneText.innerHTML=`
  <div class='fortune-item'>💘 爱情：${pick(base.love)} <span class='stars'>${randomStars()}</span></div>
  <div class='fortune-item'>💼 事业：${pick(base.career)} <span class='stars'>${randomStars()}</span></div>
  <div class='fortune-item'>💪 健康：${pick(base.health)} <span class='stars'>${randomStars()}</span></div>
  <hr style='opacity:0.3'>
  📖 <b>${card.name[lang]}</b>：${card.meaning[lang]}<br>
  🔄 ${reversed?base.revHint:base.norHint}`;
  fortuneBox.style.display="block";
}

// 缓存
const todayKey=new Date().toISOString().slice(0,10);
let saved=JSON.parse(localStorage.getItem("tarot_today")||"null");
if(saved&&saved.date===todayKey){showCard(saved.card,saved.reversed,saved.lang,true);btn.textContent="今日已抽牌（点击重新查看）";}

// 抽牌逻辑
btn.addEventListener("click",()=>{
  const lang=langSelect.value;
  const stored=JSON.parse(localStorage.getItem("tarot_today")||"null");
  if(stored&&stored.date===todayKey){showCard(stored.card,stored.reversed,stored.lang,true);return;}
  const card=tarotDeck[Math.floor(Math.random()*tarotDeck.length)];
  const reversed=Math.random()<0.5;
  localStorage.setItem("tarot_today",JSON.stringify({date:todayKey,card,reversed,lang}));
  showCard(card,reversed,lang,false);
});

// 显示卡片
function showCard(card,reversed,lang){
  const img=getImgUrl(card.id,card.suit);
  front.style.backgroundImage=`url('${img}')`;
  front.style.transform=reversed?"rotate(180deg)":"rotate(0)";
  cardName.textContent=card.name[lang]+(reversed?"（逆位）":"（正位）");
  meaning.textContent=(reversed?"【逆位含义】":"【正位含义】")+" "+card.meaning[lang];
  document.body.style.background=`radial-gradient(circle at center, ${elementsColor[card.suit]||"#6c5ce7"}, #0d1321)`;
  inner.classList.add("flip");
  genFortune(card,reversed,lang);
}
});
</script>
</body>
</html>
