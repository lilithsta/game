<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>戀愛版 MBTI 測試</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827ee; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#22d3ee; /* cyan-400 */
      --accent2:#a78bfa; /* violet-400 */
      --ok:#34d399; /* emerald-400 */
      --warn:#fb7185; /* rose-400 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, #1e293b 0%, var(--bg) 60%), linear-gradient(180deg, #0b1020, #0f172a);
      color:var(--text);
      display:flex; align-items:center; justify-content:center;
    }
    .app{ width:min(100%, 980px); padding:24px; }
    .card{ background:var(--card); backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.06); border-radius:20px; overflow:hidden; box-shadow: 0 10px 40px rgba(0,0,0,.4); }
    header{ padding:22px 24px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    h1{ font-size:clamp(20px, 3vw, 28px); margin:0; letter-spacing:.4px }
    .badges{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .badge{ font-size:12px; color:#0b1220; background:linear-gradient(120deg, var(--accent), var(--accent2)); padding:6px 10px; border-radius:999px; }
    .content{ padding:20px }
    .row{ display:grid; grid-template-columns: 1.1fr .9fr; gap:18px }
    @media (max-width:900px){ .row{ grid-template-columns:1fr } }
    .panel{ background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:18px }
    .intro p{ color:var(--muted); margin:8px 0 0 }
    .controls{ display:flex; gap:10px; flex-wrap:wrap }
    button, .linkbtn{
      background:linear-gradient(120deg, rgba(34,211,238,.12), rgba(167,139,250,.12));
      color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:12px;
      padding:10px 14px; cursor:pointer; font-weight:600;
    }
    button:hover, .linkbtn:hover{ border-color: rgba(255,255,255,.24) }
    button.ghost{ background:transparent }
    .progress{ height:8px; background:#0b1220; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.08); }
    .progress>div{ height:100%; background:linear-gradient(90deg, var(--accent), var(--accent2)); width:0% }
    .q{ margin:14px 0; padding:14px; border:1px solid rgba(255,255,255,.08); border-radius:14px; background:rgba(0,0,0,.16) }
    .q h3{ margin:0 0 8px; font-size:16px }
    .opt{ display:flex; gap:10px; margin-top:8px; flex-wrap:wrap }
    .opt label{ display:flex; align-items:center; gap:8px; background:rgba(255,255,255,.04); padding:10px 12px; border-radius:10px; cursor:pointer; border:1px solid rgba(255,255,255,.06) }
    .opt input{ width:16px; height:16px }
    .muted{ color:var(--muted); font-size:13px }
    .typebox{ display:grid; grid-template-columns: 1fr 1fr; gap:10px }
    .pill{ border:1px dashed rgba(255,255,255,.16); padding:6px 10px; border-radius:999px; text-align:center; font-size:13px }
    .bigtype{ font-size:40px; font-weight:900; letter-spacing:2px; text-align:center; margin:10px 0 }
    .result-card{ border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px; background:rgba(255,255,255,.03) }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr } }
    .kvs{ display:grid; grid-template-columns: .9fr 1.1fr; gap:8px; align-items:center }
    .kv{ padding:10px; border:1px solid rgba(255,255,255,.08); border-radius:12px }
    .hint{ font-size:12px; color:var(--muted) }
    footer{ padding:12px 18px; border-top:1px solid rgba(255,255,255,.06); display:flex; gap:10px; justify-content:space-between; flex-wrap:wrap }
    .toast{ position:fixed; right:16px; bottom:16px; padding:10px 14px; border-radius:10px; background:#101826; border:1px solid rgba(255,255,255,.1); display:none }
    a.inline{ color:var(--accent) }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" id="app">
      <header>
        <h1>💘 戀愛版 MBTI 測試</h1>
        <div class="badges">
          <span class="badge">立即作答 ~ 3-5 分鐘</span>
          <span class="badge">無需登入</span>
        </div>
      </header>

      <div class="content">
        <div class="row">
          <section class="panel intro">
            <h2 style="margin:0">這是什麼？</h2>
            <p>根據 4 個維度（外向/內向、感覺/直覺、思考/情感、判斷/知覺）推測你的戀愛傾向，生成 16 型人格（如 ENFP、ISTJ）。僅供娛樂參考～</p>
            <div class="controls" style="margin-top:10px">
              <button id="startBtn">開始測試</button>
              <button class="ghost" id="loadBtn">載入上次結果</button>
              <button class="ghost" id="shareBtn">分享本頁</button>
            </div>
            <div class="muted" id="hashInfo"></div>
          </section>

          <section class="panel">
            <div class="progress" aria-label="作答進度"><div id="bar"></div></div>
            <div id="quiz"></div>
            <div class="controls" style="justify-content:space-between">
              <div>
                <button id="prevBtn" disabled>上一步</button>
                <button id="nextBtn" disabled>下一步</button>
              </div>
              <button id="submitBtn" disabled>查看結果</button>
            </div>
          </section>
        </div>

        <div class="grid" style="margin-top:14px">
          <section class="result-card" id="result" hidden>
            <div class="kvs">
              <div class="kv">
                <div class="muted">你的類型</div>
                <div class="bigtype" id="typeText">----</div>
                <div class="typebox" id="letters"></div>
              </div>
              <div class="kv">
                <div class="muted">戀愛標籤</div>
                <div class="typebox" id="tags"></div>
              </div>
            </div>
            <div style="margin-top:10px" id="desc"></div>

            <div class="panel" style="margin-top:12px">
              <h3 style="margin:0 0 8px">適配&互補</h3>
              <div class="muted">根據典型互補/同頻理論生成，僅供參考。</div>
              <div id="matches" style="margin-top:8px" class="typebox"></div>
            </div>

            <div class="controls" style="margin-top:12px; justify-content:space-between">
              <div>
                <button id="againBtn">再測一次</button>
              </div>
              <div>
                <button id="copyLinkBtn">複製結果連結</button>
                <button id="saveBtn">儲存到本機</button>
              </div>
            </div>
          </section>

          <section class="result-card">
            <h3 style="margin:0 0 8px">關於分數</h3>
            <p class="hint">每題 2 選 1。系統對 4 條維度分別累計：E↔I、S↔N、T↔F、J↔P。正向靠左、負向靠右。若接近 0，代表該維度較平衡。</p>
            <div id="bars"></div>
          </section>
        </div>
      </div>

      <footer>
        <div class="muted">© 2025 戀愛版 MBTI • 由純前端實作（可離線使用）</div>
        <div class="muted">改題、改配色或加入多語？歡迎在程式裡調整 <code>QUESTIONS</code> 與 <code>TYPE_INFO</code>。</div>
      </footer>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
// ====== 題庫：每題對應一個維度方向 ======
const QUESTIONS = [
  { id:1, dim:"EI", q:"初次約會，你會：", a:[{t:"主動安排行程並帶動氣氛", v:+1},{t:"安靜觀察對方、慢熱漸進", v:-1}]},
  { id:2, dim:"SN", q:"聊天話題偏好：", a:[{t:"具體生活與可落地計畫", v:+1},{t:"腦洞靈感與未來想像", v:-1}]},
  { id:3, dim:"TF", q:"面對衝突，你：", a:[{t:"就事論事、先談邏輯與原則", v:+1},{t:"先顧情緒、強調感受與關係", v:-1}]},
  { id:4, dim:"JP", q:"告白時機：", a:[{t:"規劃到位、選擇合適節點", v:+1},{t:"順勢而為、感覺到了就說", v:-1}]},
  { id:5, dim:"EI", q:"週末相處，你傾向：", a:[{t:"一起參加朋友聚會或戶外活動", v:+1},{t:"兩人世界窩家裡或小而美", v:-1}]},
  { id:6, dim:"SN", q:"紀念日禮物更在意：", a:[{t:"實用耐看、值得長期使用", v:+1},{t:"有故事的、象徵性的驚喜", v:-1}]},
  { id:7, dim:"TF", q:"TA 因工作煩躁時你：", a:[{t:"協助分析問題並給方案", v:+1},{t:"陪伴傾聽與情緒支持", v:-1}]},
  { id:8, dim:"JP", q:"旅行風格：", a:[{t:"行程表到小時、預定完善", v:+1},{t:"說走就走、現場依心情調整", v:-1}]},
  { id:9, dim:"EI", q:"認識新朋友：", a:[{t:"很快打成一片、社牛加成", v:+1},{t:"慢慢熟悉、質量重於數量", v:-1}]},
  { id:10, dim:"SN", q:"戀愛中的安全感源自：", a:[{t:"明確承諾與可見投入", v:+1},{t:"彼此靈魂頻率與默契", v:-1}]},
  { id:11, dim:"TF", q:"送對方禮物時你會：", a:[{t:"研究需求與性價比", v:+1},{t:"觀察TA喜好、打造專屬感", v:-1}]},
  { id:12, dim:"JP", q:"家務分工：", a:[{t:"明確規則與固定節奏", v:+1},{t:"隨機輪流、看當天狀態", v:-1}]},
  { id:13, dim:"EI", q:"感情出問題時：", a:[{t:"拉到檯面上討論與協調", v:+1},{t:"先自我消化、找時機再聊", v:-1}]},
  { id:14, dim:"SN", q:"第一次見家長：", a:[{t:"注重細節與流程、按部就班", v:+1},{t:"相信自然互動、重視氛圍", v:-1}]},
  { id:15, dim:"TF", q:"對另一半的期待：", a:[{t:"能力可靠、做事有效率", v:+1},{t:"體貼溫暖、情緒穩定", v:-1}]},
  { id:16, dim:"JP", q:"訂結婚計畫：", a:[{t:"時間線/預算表先出來", v:+1},{t:"看緣分、邊走邊定", v:-1}]},
];

// ====== 16 型描述與標籤 ======
const TYPE_INFO = {
  ENFJ:{ name:"溫暖領隊", tags:["共情高手","主動給安全感","重視承諾"], love:"擅長建立長期關係，會主動規劃並照顧對方感受。", match:["INFP","ISFP","INTP"] },
  ENFP:{ name:"靈感冒險家", tags:["高熱情","驚喜製造機","重視浪漫"], love:"情感表達豐富，喜歡新鮮與連結，期盼被理解與共同成長。", match:["INFJ","INTJ","ISFJ"] },
  ENTJ:{ name:"行動派指揮", tags:["目標導向","效率至上","可靠"], love:"在關係中會主動設定方向與節奏，但也需要彼此尊重。", match:["INFP","ISFP","ENFP"] },
  ENTP:{ name:"腦洞玩家", tags:["辯思狂熱","創新互動","不喜無聊"], love:"需要思想火花與自由空間，欣賞好奇、能對話的伴侶。", match:["INFJ","ISFJ","INTJ"] },
  ESFJ:{ name:"貼心管家", tags:["體貼周到","關係維護","務實"], love:"注重儀式感與穩定經營，渴望被肯定與互相關懷。", match:["ISFP","INFP","ESFP"] },
  ESFP:{ name:"現場派快樂", tags:["氛圍王","熱情即時","社交能量"], love:"在相處中注重快樂體驗與陪伴，偏愛自然真誠。", match:["ISFJ","ISTJ","ENFJ"] },
  ESTJ:{ name:"務實領班", tags:["有原則","可靠穩定","重承諾"], love:"講究分工和計畫，給足安全感；希望彼此守規則。", match:["ISFP","INFP","ESFP"] },
  ESTP:{ name:"行動現實家", tags:["果斷直接","愛挑戰","臨場感強"], love:"偏愛直接溝通與共同體驗，不拖泥帶水。", match:["ISFJ","INFJ","ESFJ"] },
  INFJ:{ name:"洞察引導者", tags:["深度連結","理想主義","溫柔堅定"], love:"渴望靈魂契合，願意長期投入與共創價值。", match:["ENFP","ENTP","ISFP"] },
  INFP:{ name:"理想戀人", tags:["浪漫純粹","感性細膩","重價值觀"], love:"看重價值一致與被理解，會因愛成長。", match:["ENFJ","ENTJ","ESFJ"] },
  INTJ:{ name:"戰略伴侶", tags:["深謀遠慮","邏輯清晰","重效率"], love:"偏好理性互動與長線規劃，需要尊重邊界。", match:["ENFP","ENFJ","ESFP"] },
  INTP:{ name:"思辨合夥人", tags:["理性探究","需要空間","真誠"], love:"重視思想交流與真實，不擅表面社交。", match:["ENFJ","ESFJ","ISFJ"] },
  ISFJ:{ name:"溫柔守護", tags:["細膩務實","重承諾","穩定溫暖"], love:"在日常中默默付出，期待被看見與珍惜。", match:["ENFP","ESFP","ENTP"] },
  ISFP:{ name:"感性藝術家", tags:["自由感","體驗派","真誠"], love:"喜歡自然相處與彼此尊重，排斥過度控制。", match:["ENFJ","ESTJ","ESFJ"] },
  ISTJ:{ name:"可靠實幹家", tags:["有秩序","守承諾","重細節"], love:"重視責任與穩定，愛在細節與行動中。", match:["ENFP","ESFP","INFP"] },
  ISTP:{ name:"冷靜實作派", tags:["獨立","行動導向","不黏人"], love:"尊重彼此空間與務實互動，少廢話多做事。", match:["ENFJ","ESFJ","INFJ"] },
};

// ====== 狀態 ======
const state = {
  page: 0, // 每頁 2 題
  perPage: 2,
  answers: {},
  score: {EI:0, SN:0, TF:0, JP:0},
};

// ====== 元素 ======
const quizEl = document.getElementById('quiz');
const barEl = document.getElementById('bar');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const startBtn = document.getElementById('startBtn');
const againBtn = document.getElementById('againBtn');
const resultEl = document.getElementById('result');
const typeText = document.getElementById('typeText');
const lettersEl = document.getElementById('letters');
const tagsEl = document.getElementById('tags');
const descEl = document.getElementById('desc');
const matchesEl = document.getElementById('matches');
const barsEl = document.getElementById('bars');
const toast = document.getElementById('toast');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const copyLinkBtn = document.getElementById('copyLinkBtn');
const shareBtn = document.getElementById('shareBtn');
const hashInfo = document.getElementById('hashInfo');

function showToast(msg){
  toast.textContent = msg; toast.style.display='block';
  setTimeout(()=> toast.style.display='none', 2200);
}

// ====== 進度、頁面渲染 ======
function render(){
  const total = QUESTIONS.length;
  const answered = Object.keys(state.answers).length;
  const pct = Math.round(answered/total*100);
  barEl.style.width = pct + '%';

  const start = state.page * state.perPage;
  const items = QUESTIONS.slice(start, start + state.perPage);
  quizEl.innerHTML = items.map(q => renderQuestion(q)).join('');

  // 控制按鈕
  prevBtn.disabled = state.page === 0;
  nextBtn.disabled = answered < Math.min(total, (state.page+1)*state.perPage);
  submitBtn.disabled = answered < total;
}

function renderQuestion(q){
  const name = 'q_'+q.id;
  const val = state.answers[q.id];
  return `
    <div class="q">
      <h3>${q.id}. ${q.q}</h3>
      <div class="opt">
        ${q.a.map((opt, idx)=>`<label>
          <input type="radio" name="${name}" value="${opt.v}" ${val==opt.v? 'checked':''} />
          <span>${opt.t}</span>
        </label>`).join('')}
      </div>
      <div class="hint">維度：${q.dim}（左選項偏正向，右選項偏負向）</div>
    </div>
  `;
}

quizEl.addEventListener('change', (e)=>{
  const target = e.target;
  if(target && target.name && target.type==='radio'){
    const id = Number(target.name.split('_')[1]);
    const q = QUESTIONS.find(x=>x.id===id);
    state.answers[id] = Number(target.value);
    // 更新 score（先重算更穩妥）
    state.score = {EI:0,SN:0,TF:0,JP:0};
    for(const q of QUESTIONS){
      const v = state.answers[q.id];
      if(typeof v === 'number') state.score[q.dim]+= v;
    }
    render();
  }
});

prevBtn.addEventListener('click', ()=>{ state.page = Math.max(0, state.page-1); render(); });
nextBtn.addEventListener('click', ()=>{ state.page = Math.min(Math.ceil(QUESTIONS.length/state.perPage)-1, state.page+1); render(); });
startBtn.addEventListener('click', ()=>{ state.page=0; render(); document.getElementById('app').scrollIntoView({behavior:'smooth'}); });

// ====== 計算結果 ======
function sign(x){ return x>0?1:(x<0?-1:0); }
function toType(score){
  const EI = score.EI>=0 ? 'E':'I';
  const SN = score.SN>=0 ? 'S':'N';
  const TF = score.TF>=0 ? 'T':'F';
  const JP = score.JP>=0 ? 'J':'P';
  return EI+SN+TF+JP;
}

submitBtn.addEventListener('click', ()=>{
  const type = toType(state.score);
  showResult(type, state.score);
  const share = encodeShare(type, state.score);
  history.replaceState(null, '', '#'+share);
});

againBtn?.addEventListener('click', ()=>{
  state.page=0; state.answers={}; state.score={EI:0,SN:0,TF:0,JP:0};
  resultEl.hidden=true; render();
});

saveBtn.addEventListener('click', ()=>{
  const type = toType(state.score);
  localStorage.setItem('love_mbti', JSON.stringify({type, score:state.score, t:Date.now()}));
  showToast('✅ 已儲存到本機');
});

loadBtn.addEventListener('click', ()=>{
  const raw = localStorage.getItem('love_mbti');
  if(!raw) return showToast('尚無已儲存結果');
  try{ const data = JSON.parse(raw); showResult(data.type, data.score); }catch{ showToast('載入失敗'); }
});

copyLinkBtn.addEventListener('click', ()=>{
  const url = location.href;
  navigator.clipboard.writeText(url).then(()=> showToast('🔗 已複製結果連結')).catch(()=> showToast('無法複製，請手動選取網址列'));
});

shareBtn.addEventListener('click', ()=>{
  navigator.clipboard.writeText(location.href).then(()=> showToast('已複製本頁連結，快分享給朋友！'));
});

// ====== 顯示結果 ======
function showResult(type, score){
  const info = TYPE_INFO[type] || {name:'未定義', tags:[], love:'', match:[]};
  typeText.textContent = type + ' · ' + info.name;
  lettersEl.innerHTML = letterPills(type, score);
  tagsEl.innerHTML = info.tags.map(t=> `<div class="pill">#${t}</div>`).join('');
  descEl.innerHTML = `<p><strong>戀愛傾向：</strong>${info.love}</p>`;
  matchesEl.innerHTML = info.match.map(t=> `<div class="pill">${t}</div>`).join('');
  barsEl.innerHTML = renderBars(score);
  resultEl.hidden = false;
  document.getElementById('result').scrollIntoView({behavior:'smooth'});
}

function letterPills(type, score){
  const dims = [['E','I','EI'],['S','N','SN'],['T','F','TF'],['J','P','JP']];
  return dims.map(([L,R,key])=>{
    const v = score[key];
    const left = Math.max(0, (v+4)/8*100); // -4..+4 對應 0..100 粗略視覺
    return `<div class="pill" title="${key}: ${v}">
      <strong>${type.includes(L)?L:R}</strong> / ${L}${R}
    </div>`;
  }).join('');
}

function renderBars(score){
  const items = [
    {k:'EI', l:'E', r:'I', v:score.EI},
    {k:'SN', l:'S', r:'N', v:score.SN},
    {k:'TF', l:'T', r:'F', v:score.TF},
    {k:'JP', l:'J', r:'P', v:score.JP},
  ];
  return items.map(it=>{
    const percent = Math.round((it.v+4)/8*100); // -4..+4 -> 0..100
    return `<div style="margin:10px 0">
      <div class="muted">${it.k}: ${it.l} ↔ ${it.r}（${it.v}）</div>
      <div class="progress"><div style="width:${percent}%"></div></div>
    </div>`;
  }).join('');
}

// ====== 分享／連結還原 ======
function encodeShare(type, score){
  const payload = {t:type, s:score};
  const str = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  return str;
}
function decodeShare(hash){
  try{
    const obj = JSON.parse(decodeURIComponent(escape(atob(hash))));
    return obj;
  }catch{ return null }
}

// 如網址帶 hash，自動還原
(function(){
  const h = location.hash.replace('#','');
  if(h){
    const data = decodeShare(h);
    if(data && data.t && data.s){ showResult(data.t, data.s); hashInfo.textContent = '已從網址還原結果：'+data.t; }
    else hashInfo.textContent = '偵測到分享代碼，但解析失敗。';
  }else{
    hashInfo.textContent = '小技巧：完成後會生成可分享的網址。';
  }
})();

// 初始化
render();
</script>
</body>
</html>
